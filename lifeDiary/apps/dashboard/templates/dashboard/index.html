{% extends 'base.html' %}
{% load static %}

{% block title %}ÎåÄÏãúÎ≥¥Îìú - {{ selected_date|date:"YÎÖÑ mÏõî dÏùº" }} | ÎùºÏù¥ÌîÑ Îã§Ïù¥Ïñ¥Î¶¨{% endblock %}

{% block content %}
<div class="row">
    <!-- ÎÇ†Ïßú ÏÑ†ÌÉù Î∞è ÌÜµÍ≥Ñ -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-day me-2"></i>
                    {{ selected_date|date:"YÎÖÑ mÏõî dÏùº (l)" }}
                </h5>
                <div class="d-flex gap-2">
                    <input type="date" 
                           class="form-control form-control-sm" 
                           id="dateSelector" 
                           value="{{ selected_date|date:'Y-m-d' }}"
                           style="width: 150px;">
                    <button class="btn btn-sm btn-outline-primary" onclick="goToToday()">
                        <i class="fas fa-home"></i> Ïò§Îäò
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-clock text-primary me-2"></i>
                            <div>
                                <div class="fw-bold">{{ total_slots }}</div>
                                <small class="text-muted">Ï¥ù Ïä¨Î°Ø</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <div>
                                <div class="fw-bold">{{ filled_slots }}</div>
                                <small class="text-muted">Í∏∞Î°ùÎêú Ïä¨Î°Ø</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-chart-pie text-info me-2"></i>
                            <div>
                                <div class="fw-bold">{{ fill_percentage }}%</div>
                                <small class="text-muted">Í∏∞Î°ùÎ•†</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-hourglass-half text-warning me-2"></i>
                            <div>
                                <div class="fw-bold">{{ total_hours }}ÏãúÍ∞Ñ {{ remaining_minutes }}Î∂Ñ</div>
                                <small class="text-muted">Ï¥ù Í∏∞Î°ù ÏãúÍ∞Ñ</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ÏãúÍ∞Ñ Í∑∏Î¶¨Îìú -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-th me-2"></i>
                    ÏãúÍ∞Ñ Í∑∏Î¶¨Îìú (10Î∂Ñ Îã®ÏúÑ)
                </h6>
            </div>
            <div class="card-body">
                <!-- ÏãúÍ∞Ñ ÌëúÏãú Ìó§Îçî (Í∑∏Î¶¨ÎìúÏôÄ ÎèôÏùºÌïú 12Ïó¥ Íµ¨Ï°∞) -->
                <div class="time-grid mb-3" style="grid-template-columns: repeat(12, 1fr); display: grid; gap: 2px;">
                    {% for time_header in time_headers %}
                        <div class="text-center text-muted small py-1" style="font-weight: 500;">
                            {{ time_header }}
                        </div>
                    {% endfor %}
                </div>
                
                <!-- 144Ïπ∏ Í∑∏Î¶¨Îìú -->
                <div class="time-grid" id="timeGrid">
                    {% for slot in slots %}
                        <div class="time-slot {% if slot.data %}filled{% endif %}" 
                             data-slot-index="{{ slot.index }}"
                             data-time="{{ slot.time_str }}"
                             {% if slot.data %}
                                 style="background-color: {{ slot.data.tag.color }};"
                                 title="{{ slot.time_str }} - {{ slot.data.tag.name }}{% if slot.data.memo %}: {{ slot.data.memo }}{% endif %}"
                             {% else %}
                                 title="{{ slot.time_str }} - Îπà Ïä¨Î°Ø"
                             {% endif %}
                             onclick="selectSlot({{ slot.index }})"
                             onmousedown="startDrag({{ slot.index }})"
                             onmouseenter="dragOver({{ slot.index }})"
                             onmouseup="endDrag()"
                             ontouchstart="startDrag({{ slot.index }})"
                             ontouchmove="handleTouchMove(event)"
                             ontouchend="endDrag()">
                            
                            <!-- ÏãúÍ∞Ñ ÌëúÏãú (Îß§ ÏãúÍ∞ÑÎßàÎã§) -->
                            {% if slot.minute == 0 %}
                                <div class="slot-time">{{ slot.hour|stringformat:"02d" }}:00</div>
                            {% endif %}
                            
                            <!-- ÌÉúÍ∑∏ ÌëúÏãú -->
                            {% if slot.data %}
                                <div class="position-absolute w-100 h-100 d-flex align-items-center justify-content-center">
                                    <small class="text-white fw-bold" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                                        {{ slot.data.tag.name|truncatechars:3 }}
                                    </small>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Î≤îÎ°Ä -->
                <div class="mt-3">
                    <div class="d-flex flex-wrap gap-2" id="tagLegend">
                        <div class="spinner-border spinner-border-sm text-secondary" role="status">
                            <span class="visually-hidden">Î≤îÎ°Ä Î°úÎî© Ï§ë...</span>
                        </div>
                        <small class="text-muted">Î≤îÎ°Ä Î°úÎî© Ï§ë...</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î - ÌÉúÍ∑∏ ÏÑ†ÌÉù Î∞è Ï†ïÎ≥¥ -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-edit me-2"></i>
                    Îπ†Î•∏ ÏûÖÎ†•
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label mb-0">ÌÉúÍ∑∏ ÏÑ†ÌÉù</label>
                        <div>
                            <button type="button" class="btn btn-sm btn-outline-success me-1" id="createNewTagBtn">
                                <i class="fas fa-plus"></i> ÏÉà ÌÉúÍ∑∏
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary me-1" id="manageTagsBtn">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="collapse" data-bs-target="#usageHelp" aria-expanded="false" aria-controls="usageHelp">
                                <i class="fas fa-question-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="collapse" id="usageHelp" data-bs-parent="">
                        <div class="card border-info mt-2">
                            <div class="card-body bg-light py-2">
                                <small class="text-info">
                                    <i class="fas fa-info-circle me-1"></i><strong>ÏÇ¨Ïö©Î≤ï:</strong><br>
                                    ‚Ä¢ <strong>Îã®Ïùº ÏÑ†ÌÉù:</strong> Ïä¨Î°Ø ÌÅ¥Î¶≠<br>
                                    ‚Ä¢ <strong>ÎìúÎûòÍ∑∏ ÏÑ†ÌÉù:</strong> ÎßàÏö∞Ïä§Î°ú ÎìúÎûòÍ∑∏<br>
                                    ‚Ä¢ <strong>Îã§Ï§ë ÏÑ†ÌÉù:</strong> Ctrl/Cmd + ÌÅ¥Î¶≠<br>
                                    ‚Ä¢ <strong>ÌÑ∞Ïπò:</strong> ÌÑ∞Ïπò ÌõÑ ÎìúÎûòÍ∑∏<br><br>
                                    <small class="text-muted">üí° Ïù¥ ÎèÑÏõÄÎßêÏùÄ ? Î≤ÑÌäºÏùÑ Îã§Ïãú ÌÅ¥Î¶≠ÌïòÎ©¥ Îã´ÌûôÎãàÎã§.</small>
                                </small>
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- ÌÉúÍ∑∏ Î™©Î°ùÏù¥ ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê©ÎãàÎã§ -->
                    <div class="d-grid gap-2" id="tagContainer">
                        <div class="text-center py-3">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">ÌÉúÍ∑∏ Î°úÎî© Ï§ë...</span>
                            </div>
                            <div class="mt-2 text-muted small">ÌÉúÍ∑∏ Î°úÎî© Ï§ë...</div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="memoInput" class="form-label">Î©îÎ™® (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                    <textarea class="form-control" id="memoInput" rows="3" placeholder="Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="saveSlot()" disabled id="saveBtn">
                        <i class="fas fa-save me-1"></i>
                        Ï†ÄÏû•
                    </button>
                    <button class="btn btn-outline-danger" onclick="deleteSlot()" disabled id="deleteBtn">
                        <i class="fas fa-trash me-1"></i>
                        ÏÇ≠Ï†ú
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ÏÑ†ÌÉùÎêú Ïä¨Î°Ø Ï†ïÎ≥¥ -->
        <div class="card mt-3" id="slotInfoCard" style="display: none;">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    ÏÑ†ÌÉùÎêú Ïä¨Î°Ø
                </h6>
            </div>
            <div class="card-body">
                <div id="slotInfo">
                    <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏóÖÎç∞Ïù¥Ìä∏ -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Î™®Îã¨Îì§ -->
<!-- ÏÉà ÌÉúÍ∑∏ Ï∂îÍ∞Ä Î™®Îã¨ -->
<div class="modal fade" id="createTagModal" tabindex="-1" aria-labelledby="createTagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTagModalLabel">
                    <i class="fas fa-plus me-2"></i>ÏÉà ÌÉúÍ∑∏ ÎßåÎì§Í∏∞
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createTagForm">
                    <div class="mb-3">
                        <label for="newTagName" class="form-label">ÌÉúÍ∑∏Î™Ö</label>
                        <input type="text" class="form-control" id="newTagName" placeholder="Ïòà: Ïö¥Îèô, Í≥µÎ∂Ä, Ìú¥Ïãù">
                    </div>
                    <div class="mb-3">
                        <label for="newTagColor" class="form-label">ÏÉâÏÉÅ</label>
                        <div class="d-flex align-items-center gap-2">
                            <input type="color" class="form-control form-control-color" id="newTagColor" value="#3498db">
                            <input type="text" class="form-control" id="newTagColorText" placeholder="#3498db" maxlength="7">
                        </div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>ÌÉúÍ∑∏ ÏÉùÏÑ±
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ÌÉúÍ∑∏ Í¥ÄÎ¶¨ Î™®Îã¨ -->
<div class="modal fade" id="tagManageModal" tabindex="-1" aria-labelledby="tagManageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tagManageModalLabel">
                    <i class="fas fa-tags me-2"></i>ÌÉúÍ∑∏ Í¥ÄÎ¶¨
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Í∏∞Ï°¥ ÌÉúÍ∑∏ Î™©Î°ù -->
                <div id="tagList">
                    <!-- JavaScriptÎ°ú ÎèôÏ†Å Î°úÎìú -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
</div>

<!-- ÌÉúÍ∑∏ Ìé∏Ïßë Î™®Îã¨ -->
<div class="modal fade" id="tagEditModal" tabindex="-1" aria-labelledby="tagEditModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tagEditModalLabel">
                    <i class="fas fa-edit me-2"></i>ÌÉúÍ∑∏ Ìé∏Ïßë
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editTagForm">
                    <input type="hidden" id="editTagId">
                    <div class="mb-3">
                        <label for="editTagName" class="form-label">ÌÉúÍ∑∏Î™Ö</label>
                        <input type="text" class="form-control" id="editTagName">
                    </div>
                    <div class="mb-3">
                        <label for="editTagColor" class="form-label">ÏÉâÏÉÅ</label>
                        <div class="d-flex align-items-center gap-2">
                            <input type="color" class="form-control form-control-color" id="editTagColor">
                            <input type="text" class="form-control" id="editTagColorText" maxlength="7">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                <button type="button" class="btn btn-primary" id="saveTagBtn">
                    <i class="fas fa-save me-1"></i>Ï†ÄÏû•
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'dashboard/css/dashboard.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'dashboard/js/dashboard.js' %}"></script>
{% endblock %} 